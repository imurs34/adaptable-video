<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    #content,
    #audioFile {
      display: none;
    }

    #mySlider {
      width: 100%;
    }

    
    #content {
      margin-left: auto;
      margin-right: auto;
      margin-top: 10%;

    }

    .loading {
      margin-top: 10%;
      margin-left: 50%; 
    }

    #content {
      width: 50%;
      height: 50%;
    }

    .loader {
      border: 16px solid #f3f3f3;
      /* Light grey */
      border-top: 16px solid #3498db;
      /* Blue */
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 25px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      background: #4CAF50;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      background: #4CAF50;
      cursor: pointer;
    }

    #pText {
      position: absolute;
      top: 30%;
      left: 30%;
      color: green;
      font-size: 110%;
    }
  </style>
</head>

<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <div class="loading"> 
    <h1 >Content is loading...</h1>
    <div class="loader" >
    </div>
  </div>
  

  <div id="content">

    <h1>Custom Range Slider</h1>


    <div class="mySlides fade">
      <div id="numbertext">1 / 11</div>
      <img id="slide" src="shot1.jpg">
      <!-- <p id="pText">My Header!</p> -->
    </div>
    <p id="val"> </p>
    <input type="range" min="0" max="120" value="0" id="mySlider" step=".2" oninput="showValue(this.value)"
      onchange="changeAudio(this.value)">


    <button onclick="stopClock()">Pause</button>
    <button onclick="beginClock()">Start</button>
    <button onclick="resetClock()">Reset</button>

    <audio id="audioFile" controls>
      <source src="lecture_ushist_audio.wav" type="audio/wav">
      Your browser does not support the audio element.
    </audio>

  </div>


  <script>
    const NUM_SECONDS_EACH_SLIDE = 2; // seconds for each slide 
    var num = 0;
    var images = ["shot1.jpg", "shot2.jpg", "shot3.jpg", "shot4.jpg", "shot5.jpg", "shot6.jpg", "shot7.jpg", "shot8.jpg", "shot9.jpg", "shot10.jpg", "shot11.jpg"];
    var text = ["My Header!", "My Other Header", "Something I liked to write! "];
    var audioFile = document.getElementById("audioFile");

    audioFile.onloadeddata = function () {
      $("#mySlider").attr("max", audioFile.duration);
      $(".loading").hide(1000, function () {
        $("#content").fadeIn();
      });

    };
    function log(arrOfValues) {
      arrOfValues.forEach(x => console.log(x));
    }

    /**
     * is called when on change... means that it is called when the user lets go of the slider. 
     */
    function changeAudio(timeInTrack) {
      setCurTime(timeInTrack); // changes time of file 
    }
    function showValue(val) {
      //document.querySelector("#audioFile").play(); 
      //log([val]);
      var floored = Math.floor(val);
      var imageNum = Math.floor((floored / NUM_SECONDS_EACH_SLIDE) % images.length);
      var hour = parseInt(floored / 60);
      var minute = floored % 60;
      minute = minute == 0 || minute < 10 ? ("0" + minute) : minute;
      document.querySelector("#val").innerHTML = `${hour}:${minute}`;
      $("#numbertext").text(((imageNum) + 1) + " / " + images.length + " - " + images[imageNum]);
      // log(["Changed value? Outside ",floored, val, imageNum]); 
      $("#slide").attr("src", images[imageNum]);
      $("#pText").css("top", `${(imageNum + 2) * 10}%`);
      $("#pText").css("left", `${(imageNum + 1) * 10}%`);

    }

    var startClock;
    var hasStarted = false;

    function stopClock() {
      audioFile.pause();

      hasStarted = false;
      clearInterval(startClock);
    }

    function resetClock() {
      document.querySelector("#mySlider").value = 0;
      setCurTime(0);
      stopClock();
      beginClock();
    }


    function beginClock() {
      if (hasStarted == false) {
        audioFile.play();
        startClock = setInterval(function () {
          var val = parseFloat(document.querySelector("#mySlider").value) + .2;
          //document.querySelector("#val").innerHTML = val.toFixed(0); 
          document.querySelector("#mySlider").value = val;
          //log([val]);
          showValue(val);

        }, 200);
        hasStarted = true;
      }

      function getRandomNum() {
        return Math.floor(Math.random() * 10);
      }

    }

    function setCurTime(time) {
      audioFile.currentTime = time;
    } 
  </script>

</body>

</html>